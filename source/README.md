Вот обновлённый **README.md** (корневой) под новую архитектуру — только с **Hybrid-Agent**, без Online/Offline, со всеми основными изменениями.

---

````markdown
# Status Monitor (v5.x – Гибридная архитектура)

**Status Monitor** — это система централизованного мониторинга состояния распределённой IT-инфраструктуры, полностью переведённая на концепцию гибридного агента (**Hybrid-Agent**). Мониторинг, сбор метрик и логика проверок реализованы как пайплайн шагов (pipeline) и выполняются единым агентом вне зависимости от режима доступа (локальный, сетевой, изолированная сеть).

---

## Основные особенности

- **Гибридный агент:** Все проверки (мониторинг узлов, сервисов, процессов, сертификатов и др.) выполняет один универсальный агент (Hybrid-Agent) с поддержкой локального и сетевого исполнения.
- **Пайплайн-архитектура:** Каждое задание (assignment) задаёт последовательность шагов pipeline (PowerShell/SQL/файловые/JSON/XML-анализ и т.д.), поддерживается обработка результатов и комплексный анализ.
- **Централизованный сервер (Flask + PostgreSQL):** Управление сущностями, заданиями и хранение истории через единую БД и REST API.
- **Гибкая настройка:** Все параметры заданий, расписание, pipeline и методы — централизованно через БД и веб-интерфейс.
- **Стандартизированный API:** Все агенты (и вспомогательные утилиты) работают через REST API сервера.

---

## Структура репозитория

- `postgres/` — инициализация и структура БД (PostgreSQL)
- `status/` — серверная часть (Flask API, Web UI, модели)
- `powershell/HybridAgent/` — гибридный PowerShell-агент, модуль утилит, пайплайны, примеры конфигов
- `powershell/utils/` — вспомогательные скрипты (генератор конфигов, загрузчик результатов)
- `docs/` — дополнительная документация, примеры, схемы

---

## Архитектура

- **PostgreSQL:** Структурированная схема с сущностями: подразделения, узлы, типы, методы проверок, задания, история, события, пользователи, API-ключи.
- **Flask Backend:** REST API и UI, управление заданиями (pipeline), пользователями и агентами.
- **Hybrid-Agent:** Универсальный скриптовый агент (PowerShell), получает pipeline, выполняет последовательность шагов (в том числе через `Invoke-Command` по сети), обрабатывает результат и отправляет обратно на сервер.
- **Pipeline:** Каждое задание — это JSON-массив шагов (например: сначала SQL-запрос, потом анализ файла, потом отчёт в БД), поддерживается любой порядок и комбинации шагов.

---

## Основные сценарии работы

1. **Администратор** создаёт или назначает задания (pipeline) через веб-интерфейс (или API) для нужных узлов.
2. **Hybrid-Agent** на целевом сервере/рабочей станции получает свои задания через API (или из файла в оффлайн-сценарии).
3. **Агент** выполняет pipeline (один или несколько шагов), обрабатывает результаты, формирует отчёт.
4. **Результаты** отправляются в центральную БД через API.
5. **Сервер** хранит историю, отображает статус и события, позволяет управлять настройками и получать аналитику.

---

## Компоненты и папки

- **БД:** Вся структура и скрипты создания — `postgres/`
- **Backend:** Flask + API, описание и роутинг — `status/`
- **Hybrid-Agent:** PowerShell-скрипты и модули — `powershell/HybridAgent/`
- **Вспомогательные скрипты:** `powershell/utils/` (генерация pipeline-конфига, загрузка отчётов, интеграция)

---

## Быстрый старт

1. **Создать Docker-сеть (один раз):**
   ```bash
   docker network create pu_share
````

2. **Запустить БД:**

   ```bash
   cd postgres
   docker-compose up -d
   ```

3. **Запустить backend (Flask+UI):**

   ```bash
   cd ../status
   cp .env.example .env
   # Проверь DATABASE_URL, SECRET_KEY
   docker-compose up -d
   ```

4. **Сгенерировать/назначить задания в UI или через API.**

5. **Установить и настроить Hybrid-Agent на нужных узлах (см. `powershell/HybridAgent/README.md`).**

6. **Анализировать результаты в UI.**

---

## Миграция и обновления

* Проект не поддерживает online/offline агенты: все сценарии реализуются через один Hybrid-Agent.
* Все пайплайны (pipeline) и логика проверок формализованы в БД — вручную управлять пайплайнами можно через UI или API.
* Старые скрипты и агенты больше не поддерживаются и должны быть удалены из системы и инструкций.

---

## Документация и поддержка

* Основные схемы и примеры — в папке `docs/`.
* Подробные инструкции по Hybrid-Agent и настройке — в `powershell/HybridAgent/README.md`.
* Swagger/OpenAPI спецификация — в `status/openapi.yaml` (в процессе актуализации).
* Вопросы и ишью — через GitHub Issues.

---

## Лицензия

MIT (или иная, если применимо — укажи свою).

```

---

**Пояснения к изменению:**
- Убраны все упоминания Online/Offline.
- Везде “агент” теперь только Hybrid-Agent.
- Workflow и архитектура заточены под pipeline/шаги.
- Вся история/конфиги централизованы.
- Проще поддерживать, единый интерфейс и для оффлайн, и для онлайн сценариев.

---

### Если структура проекта другая или нужны другие детали — скажи, внесу поправки!

#### Готов дать патчи для остальных файлов (`status/README.md`, swagger, routes, API docs), скажи какой следующий!
```
