#!/bin/sh
# status/entrypoint.sh

# Выход при ошибке
set -e

echo "Entrypoint: Запуск скрипта..."

# Небольшая пауза, чтобы дать БД время полностью подняться (опционально, но может помочь)
# sleep 5

echo "Entrypoint: Попытка создания пользователя 'adm' (пароль '123')..."

# Выполняем команду Flask для создания пользователя.
# Подавляем стандартный вывод (чтобы не мешать логам Gunicorn),
# но выводим сообщение, если команда завершилась с ошибкой
# (например, из-за проблем с БД или если пользователь уже есть - команда должна это обработать).
flask create-user adm 123 || echo "Entrypoint: Не удалось создать пользователя 'adm' (возможно, уже существует или ошибка БД)."

echo "Entrypoint: Пользователь 'adm' проверен/создан (или уже существовал)."
echo "Entrypoint: Запуск основной команды (Gunicorn)..."

# exec "$@" выполняет команду, которая передана в CMD Dockerfile
# В нашем случае это Gunicorn
exec "$@"